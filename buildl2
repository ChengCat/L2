#!/usr/bin/env bash
mkdir -p bin

gcc -m32 -g -c -o bin/l2compile_begin.o assets/l2compile_begin.s
gcc -m32 -g -c -o bin/l2compile.o src/compile.c
gcc -m32 -g -c -o bin/l2compile_end.o assets/l2compile_end.s
objcopy --redefine-syms=assets/l2_sym_pairs bin/l2compile.o
ar rcs bin/l2compile.a bin/l2compile_begin.o bin/l2compile.o bin/l2compile_end.o
rm bin/l2compile_begin.o
rm bin/l2compile.o
rm bin/l2compile_end.o

gcc -m32 -g -c -o bin/l2evaluate.o src/evaluate.c
objcopy --redefine-syms=assets/l2_sym_pairs bin/l2evaluate.o
gcc -m32 -g -Wl,--export-dynamic -o bin/l2evaluate bin/l2evaluate.o -ldl
rm bin/l2evaluate.o

gcc -m32 -g -c -o bin/i386.o assets/i386.s
objcopy --redefine-syms=assets/i386_sym_pairs bin/i386.o
ar rcs bin/i386.a bin/i386.o
rm bin/i386.o
